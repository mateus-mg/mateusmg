const I18nConfig={idiomaDefault:"pt",idiomasSuportados:["pt","en","es"],cache:{versao:"1.0.1",tempoExpiracaoCache:6048e5,prefixoChave:"portfolio_"},debug:!1},traducoesCache={};class I18nManager{constructor(){this.idiomaAtual=localStorage.getItem("idioma")||I18nConfig.idiomaDefault,this.traducoes={},this.carregando={},this.callbacks=[],this.precarregarIdiomas()}async precarregarIdiomas(){try{this.idiomaAtual!==I18nConfig.idiomaDefault&&await this.carregarTraducoes(I18nConfig.idiomaDefault),await this.carregarTraducoes(this.idiomaAtual),I18nConfig.debug&&console.log(`[I18n] Sistema inicializado com o idioma: ${this.idiomaAtual}`)}catch(a){console.error("[I18n] Erro ao pr\xe9-carregar tradu\xe7\xf5es:",a)}}async carregarTraducoes(a){if(this.traducoes[a])return this.traducoes[a];if(this.carregando[a])return this.carregando[a];const o=`${I18nConfig.cache.prefixoChave}traducao_${a}`,e=`${I18nConfig.cache.prefixoChave}traducao_versao_${a}`,r=`${I18nConfig.cache.prefixoChave}traducao_data_${a}`,i=localStorage.getItem(e),n=localStorage.getItem(r),c=localStorage.getItem(o);if(i===I18nConfig.cache.versao&&n&&Date.now()-parseInt(n)<I18nConfig.cache.tempoExpiracaoCache&&c){I18nConfig.debug&&console.log(`[I18n] Usando tradu\xe7\xf5es em cache para o idioma ${a}`);try{const o=JSON.parse(c);return this.traducoes[a]=o,o}catch(o){console.error(`[I18n] Erro ao processar cache de tradu\xe7\xf5es para ${a}:`,o)}}return this.carregando[a]=new Promise((async(i,n)=>{try{I18nConfig.debug&&console.log(`[I18n] Buscando tradu\xe7\xf5es do servidor para ${a}`);const n=await fetch(`i18n/${a}.json`);if(!n.ok)throw new Error(`Falha ao carregar arquivo de tradu\xe7\xe3o para ${a}: ${n.status}`);const c=await n.json();try{localStorage.setItem(o,JSON.stringify(c)),localStorage.setItem(e,I18nConfig.cache.versao),localStorage.setItem(r,Date.now().toString()),I18nConfig.debug&&console.log(`[I18n] Tradu\xe7\xf5es para ${a} armazenadas em cache`)}catch(a){console.warn("[I18n] N\xe3o foi poss\xedvel armazenar tradu\xe7\xf5es em cache:",a),this.limparCacheAntigo()}this.traducoes[a]=c,delete this.carregando[a],i(c)}catch(o){if(console.error(`[I18n] Erro ao carregar tradu\xe7\xf5es para ${a}:`,o),a!==I18nConfig.idiomaDefault){console.log(`[I18n] Tentando fallback para o idioma padr\xe3o (${I18nConfig.idiomaDefault})`);try{i(await this.carregarTraducoes(I18nConfig.idiomaDefault))}catch(a){console.error("[I18n] Tamb\xe9m falhou ao carregar o idioma padr\xe3o:",a),n(o)}}else n(o);delete this.carregando[a]}})),this.carregando[a]}async traduzir(a,o={},e=null,r=null){const i=e||this.idiomaAtual;try{const e=await this.carregarTraducoes(i);let n=this.buscarValorPorChave(e,a);if(null==n&&i!==I18nConfig.idiomaDefault){I18nConfig.debug&&console.log(`[I18n] Chave "${a}" n\xe3o encontrada em ${i}, usando fallback para ${I18nConfig.idiomaDefault}`);const o=await this.carregarTraducoes(I18nConfig.idiomaDefault);n=this.buscarValorPorChave(o,a)}return null==n&&(n=null!==r?r:a,I18nConfig.debug&&console.warn(`[I18n] Chave "${a}" n\xe3o encontrada em nenhum idioma. Usando fallback:`,n)),"object"==typeof n&&null!==n&&n.traducao&&(n=n.traducao),o&&Object.keys(o).length>0&&(n=this.substituirParametros(n,o)),n}catch(o){return console.error(`[I18n] Erro ao buscar tradu\xe7\xe3o para "${a}":`,o),null!==r?r:a}}traduzirSync(a,o={},e=null){let r=null;return this.traducoes[this.idiomaAtual]&&(r=this.buscarValorPorChave(this.traducoes[this.idiomaAtual],a)),null==r&&this.idiomaAtual!==I18nConfig.idiomaDefault&&this.traducoes[I18nConfig.idiomaDefault]&&(r=this.buscarValorPorChave(this.traducoes[I18nConfig.idiomaDefault],a)),null==r&&(r=null!==e?e:a),"object"==typeof r&&null!==r&&r.traducao&&(r=r.traducao),o&&Object.keys(o).length>0&&(r=this.substituirParametros(r,o)),r}buscarValorPorChave(a,o){if(!a||!o)return null;const e=o.split(".");let r=a;for(let a=0;a<e.length;a++){if(null==r||"object"!=typeof r)return null;r=r[e[a]]}return r}substituirParametros(a,o){if("string"!=typeof a)return a;let e=a;for(const[a,r]of Object.entries(o)){const o=new RegExp(`{{${a}}}`,"g");e=e.replace(o,r)}return e}async alterarIdioma(a){if(!I18nConfig.idiomasSuportados.includes(a))return console.error(`[I18n] Idioma n\xe3o suportado: ${a}`),!1;try{localStorage.setItem("idioma",a),localStorage.setItem("idioma_versao",I18nConfig.cache.versao),localStorage.setItem("idioma_data",Date.now().toString()),this.idiomaAtual=a,await this.carregarTraducoes(a);for(const o of this.callbacks)try{await o(a)}catch(a){console.error("[I18n] Erro em callback de altera\xe7\xe3o de idioma:",a)}return!0}catch(o){return console.error(`[I18n] Erro ao alterar idioma para ${a}:`,o),!1}}onIdiomaAlterado(a){"function"==typeof a&&this.callbacks.push(a)}removerCallback(a=null){this.callbacks=null===a?[]:this.callbacks.filter((o=>o!==a))}async traduzirElementos(a=document){try{if(a===document){const a=await this.traduzir("tituloDocumento");document.title=a;const o=document.querySelector('meta[name="description"]');if(o){const a=await this.traduzir("metaDescricao");o.setAttribute("content",a)}}a.querySelectorAll("[data-i18n]").forEach((async a=>{const o=a.getAttribute("data-i18n"),e=await this.traduzir(o);a.textContent=e})),a.querySelectorAll("[data-i18n-html]").forEach((async a=>{const o=a.getAttribute("data-i18n-html"),e=await this.traduzir(o);a.innerHTML=e})),a.querySelectorAll("[data-i18n-botao]").forEach((async a=>{const o=`botoes.${a.getAttribute("data-i18n-botao").split(".").pop()}`,e=await this.traduzir(o);a.innerHTML=e})),a.querySelectorAll("[data-i18n-placeholder]").forEach((async a=>{const o=a.getAttribute("data-i18n-placeholder"),e=await this.traduzir(o);a.setAttribute("placeholder",e)})),a.querySelectorAll("[data-i18n-alt]").forEach((async a=>{const o=a.getAttribute("data-i18n-alt"),e=await this.traduzir(o);a.setAttribute("alt",e)}))}catch(a){console.error("[I18n] Erro ao traduzir elementos:",a)}}limparCacheAntigo(){console.log("[I18n] Limpando cache antigo para liberar espa\xe7o");try{const a=[],o=`${I18nConfig.cache.prefixoChave}traducao_`;for(let e=0;e<localStorage.length;e++){const r=localStorage.key(e);if(r&&r.startsWith(o)){const e=r.replace(o,"").split("_")[0],i=localStorage.getItem(`${I18nConfig.cache.prefixoChave}traducao_data_${e}`);a.push({chave:r,idioma:e,data:i?parseInt(i):0})}}a.sort(((a,o)=>a.data-o.data));const e=Math.ceil(a.length/2);for(let o=0;o<e&&o<a.length;o++){const e=a[o];localStorage.removeItem(e.chave),localStorage.removeItem(`${I18nConfig.cache.prefixoChave}traducao_versao_${e.idioma}`),localStorage.removeItem(`${I18nConfig.cache.prefixoChave}traducao_data_${e.idioma}`),I18nConfig.debug&&console.log(`[I18n] Cache removido: ${e.chave}`)}console.log(`[I18n] ${e} itens de cache antigos removidos`)}catch(a){console.error("[I18n] Erro ao limpar cache:",a)}}getIdiomaAtual(){return this.idiomaAtual}getIdiomasSuportados(){return I18nConfig.idiomasSuportados}}window.i18n=new I18nManager,document.addEventListener("DOMContentLoaded",(()=>{"loading"===document.readyState?I18nConfig.debug&&console.log("[I18n] Aguardando DOMContentLoaded para inicializar as tradu\xe7\xf5es"):(I18nConfig.debug&&console.log("[I18n] DOM j\xe1 carregado, inicializando tradu\xe7\xf5es"),window.i18n.traduzirElementos())})),window.t=async function(a,o,e){return await window.i18n.traduzir(a,o,null,e)},window.tSync=function(a,o,e){return window.i18n.traduzirSync(a,o,e)},window.alterarIdioma=async function(a){const o=await window.i18n.alterarIdioma(a);return o&&await window.i18n.traduzirElementos(),o};
//# sourceMappingURL=script.js.map