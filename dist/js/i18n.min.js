const I18nConfig={idiomaDefault:"pt",idiomasSuportados:["pt","en","es"],cache:{versao:"1.0.1",tempoExpiracaoCache:6048e5,prefixoChave:"portfolio_"},debug:!1},traducoesCache={};class I18nManager{constructor(){this.idiomaAtual=localStorage.getItem("idioma")||I18nConfig.idiomaDefault,this.traducoes={},this.carregando={},this.callbacks=[],this.precarregarIdiomas()}async precarregarIdiomas(){try{this.idiomaAtual!==I18nConfig.idiomaDefault&&await this.carregarTraducoes(I18nConfig.idiomaDefault),await this.carregarTraducoes(this.idiomaAtual),I18nConfig.debug&&console.log(`[I18n] Sistema inicializado com o idioma: ${this.idiomaAtual}`)}catch(a){console.error("[I18n] Erro ao pr\xe9-carregar tradu\xe7\xf5es:",a)}}async carregarTraducoes(a){if(this.traducoes[a])return this.traducoes[a];if(this.carregando[a])return this.carregando[a];const o=`${I18nConfig.cache.prefixoChave}traducao_${a}`,t=`${I18nConfig.cache.prefixoChave}traducao_versao_${a}`,e=`${I18nConfig.cache.prefixoChave}traducao_data_${a}`,r=localStorage.getItem(t),i=localStorage.getItem(e),n=localStorage.getItem(o);if(r===I18nConfig.cache.versao&&i&&Date.now()-parseInt(i)<I18nConfig.cache.tempoExpiracaoCache&&n){I18nConfig.debug&&console.log(`[I18n] Usando tradu\xe7\xf5es em cache para o idioma ${a}`);try{const o=JSON.parse(n);return this.traducoes[a]=o,o}catch(o){console.error(`[I18n] Erro ao processar cache de tradu\xe7\xf5es para ${a}:`,o)}}return this.carregando[a]=new Promise((async(r,i)=>{try{I18nConfig.debug&&console.log(`[I18n] Buscando tradu\xe7\xf5es do servidor para ${a}`);const i=await fetch(`i18n/${a}.json`);if(!i.ok)throw new Error(`Falha ao carregar arquivo de tradu\xe7\xe3o para ${a}: ${i.status}`);const n=await i.json();try{localStorage.setItem(o,JSON.stringify(n)),localStorage.setItem(t,I18nConfig.cache.versao),localStorage.setItem(e,Date.now().toString()),I18nConfig.debug&&console.log(`[I18n] Tradu\xe7\xf5es para ${a} armazenadas em cache`)}catch(a){console.warn("[I18n] N\xe3o foi poss\xedvel armazenar tradu\xe7\xf5es em cache:",a),this.limparCacheAntigo()}this.traducoes[a]=n,delete this.carregando[a],r(n)}catch(o){if(console.error(`[I18n] Erro ao carregar tradu\xe7\xf5es para ${a}:`,o),a!==I18nConfig.idiomaDefault){console.log(`[I18n] Tentando fallback para o idioma padr\xe3o (${I18nConfig.idiomaDefault})`);try{r(await this.carregarTraducoes(I18nConfig.idiomaDefault))}catch(a){console.error("[I18n] Tamb\xe9m falhou ao carregar o idioma padr\xe3o:",a),i(o)}}else i(o);delete this.carregando[a]}})),this.carregando[a]}async traduzir(a,o={},t=null,e=null){const r=t||this.idiomaAtual;try{const t=await this.carregarTraducoes(r);let i=this.buscarValorPorChave(t,a);if(null==i&&r!==I18nConfig.idiomaDefault){I18nConfig.debug&&console.log(`[I18n] Chave "${a}" n\xe3o encontrada em ${r}, usando fallback para ${I18nConfig.idiomaDefault}`);const o=await this.carregarTraducoes(I18nConfig.idiomaDefault);i=this.buscarValorPorChave(o,a)}return null==i&&(i=null!==e?e:a,I18nConfig.debug&&console.warn(`[I18n] Chave "${a}" n\xe3o encontrada em nenhum idioma. Usando fallback:`,i)),"object"==typeof i&&null!==i&&i.traducao&&(i=i.traducao),o&&Object.keys(o).length>0&&(i=this.substituirParametros(i,o)),i}catch(o){return console.error(`[I18n] Erro ao buscar tradu\xe7\xe3o para "${a}":`,o),null!==e?e:a}}traduzirSync(a,o={},t=null){let e=null;return this.traducoes[this.idiomaAtual]&&(e=this.buscarValorPorChave(this.traducoes[this.idiomaAtual],a)),null==e&&this.idiomaAtual!==I18nConfig.idiomaDefault&&this.traducoes[I18nConfig.idiomaDefault]&&(e=this.buscarValorPorChave(this.traducoes[I18nConfig.idiomaDefault],a)),null==e&&(e=null!==t?t:a),"object"==typeof e&&null!==e&&e.traducao&&(e=e.traducao),o&&Object.keys(o).length>0&&(e=this.substituirParametros(e,o)),e}buscarValorPorChave(a,o){if(!a||!o)return null;const t=o.split(".");let e=a;for(let a=0;a<t.length;a++){if(null==e||"object"!=typeof e)return null;e=e[t[a]]}return e}substituirParametros(a,o){if("string"!=typeof a)return a;let t=a;for(const[a,e]of Object.entries(o)){const o=new RegExp(`{{${a}}}`,"g");t=t.replace(o,e)}return t}async alterarIdioma(a){if(!I18nConfig.idiomasSuportados.includes(a))return console.error(`[I18n] Idioma n\xe3o suportado: ${a}`),!1;try{localStorage.setItem("idioma",a),localStorage.setItem("idioma_versao",I18nConfig.cache.versao),localStorage.setItem("idioma_data",Date.now().toString()),this.idiomaAtual=a,await this.carregarTraducoes(a);for(const o of this.callbacks)try{await o(a)}catch(a){console.error("[I18n] Erro em callback de altera\xe7\xe3o de idioma:",a)}return!0}catch(o){return console.error(`[I18n] Erro ao alterar idioma para ${a}:`,o),!1}}onIdiomaAlterado(a){"function"==typeof a&&this.callbacks.push(a)}removerCallback(a=null){this.callbacks=null===a?[]:this.callbacks.filter((o=>o!==a))}async traduzirElementos(a=document){try{if(a===document){const a=await this.traduzir("tituloDocumento");document.title=a;const o=document.querySelector('meta[name="description"]');if(o){const a=await this.traduzir("metaDescricao");o.setAttribute("content",a)}}a.querySelectorAll("[data-i18n]").forEach((async a=>{const o=a.getAttribute("data-i18n"),t=await this.traduzir(o);a.textContent=t})),a.querySelectorAll("[data-i18n-html]").forEach((async a=>{const o=a.getAttribute("data-i18n-html"),t=await this.traduzir(o);a.innerHTML=t})),a.querySelectorAll("[data-i18n-botao]").forEach((async a=>{const o=`botoes.${a.getAttribute("data-i18n-botao").split(".").pop()}`,t=await this.traduzir(o);a.innerHTML=t})),a.querySelectorAll("[data-i18n-placeholder]").forEach((async a=>{const o=a.getAttribute("data-i18n-placeholder"),t=await this.traduzir(o);a.setAttribute("placeholder",t)})),a.querySelectorAll("[data-i18n-alt]").forEach((async a=>{const o=a.getAttribute("data-i18n-alt"),t=await this.traduzir(o);a.setAttribute("alt",t)}))}catch(a){console.error("[I18n] Erro ao traduzir elementos:",a)}}limparCacheAntigo(){console.log("[I18n] Limpando cache antigo para liberar espa\xe7o");try{const a=[],o=`${I18nConfig.cache.prefixoChave}traducao_`;for(let t=0;t<localStorage.length;t++){const e=localStorage.key(t);if(e&&e.startsWith(o)){const t=e.replace(o,"").split("_")[0],r=localStorage.getItem(`${I18nConfig.cache.prefixoChave}traducao_data_${t}`);a.push({chave:e,idioma:t,data:r?parseInt(r):0})}}a.sort(((a,o)=>a.data-o.data));const t=Math.ceil(a.length/2);for(let o=0;o<t&&o<a.length;o++){const t=a[o];localStorage.removeItem(t.chave),localStorage.removeItem(`${I18nConfig.cache.prefixoChave}traducao_versao_${t.idioma}`),localStorage.removeItem(`${I18nConfig.cache.prefixoChave}traducao_data_${t.idioma}`),I18nConfig.debug&&console.log(`[I18n] Cache removido: ${t.chave}`)}console.log(`[I18n] ${t} itens de cache antigos removidos`)}catch(a){console.error("[I18n] Erro ao limpar cache:",a)}}getIdiomaAtual(){return this.idiomaAtual}getIdiomasSuportados(){return I18nConfig.idiomasSuportados}}window.i18n=new I18nManager,document.addEventListener("DOMContentLoaded",(()=>{"loading"===document.readyState?I18nConfig.debug&&console.log("[I18n] Aguardando DOMContentLoaded para inicializar as tradu\xe7\xf5es"):(I18nConfig.debug&&console.log("[I18n] DOM j\xe1 carregado, inicializando tradu\xe7\xf5es"),window.i18n.traduzirElementos())})),window.t=async function(a,o,t){return await window.i18n.traduzir(a,o,null,t)},window.tSync=function(a,o,t){return window.i18n.traduzirSync(a,o,t)},window.alterarIdioma=async function(a){const o=await window.i18n.alterarIdioma(a);return o&&await window.i18n.traduzirElementos(),o};
//# sourceMappingURL=script.js.map